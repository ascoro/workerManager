/*! workerManager - v0.1.0 - 2013-07-17
* Copyright (c) 2013 Albert Serra; Licensed  */
var workerManager=function(a){a=a||{};var b=this,c=a.functions||[],d=[],e=[],f=[],g=a.numWorkers||4,h=function(a){for(var b=a.length,c="",d=0;b>d;d++){var e=a[d];c+='case "'+e.name+'":'+e.code+";break;"}return URL.createObjectURL(new window.Blob(["self.addEventListener('message', function(e) { var o = JSON.parse(e.data);var params = o.params; var result={success:true}; switch(o.name){"+c+"default:result={success:false,message:'Not implemented'};break;}; result.callbackHash=o.callbackHash;self.postMessage(JSON.stringify(result)); }, false);"]))},i=function(){return new Worker(h(c))},j=function(){var a=i();return a.addEventListener("message",function(a){o(this,JSON.parse(a.data))},!1),a.count=f.length,a.activeTasks=0,f.push(a),a},k=function(){for(var a=-1,b=0,c=0;f[c];c++){if(0==f[c].activeTasks)return f[c];(f[c].activeTasks<a||0>a)&&(a=f[c].activeTasks,b=c)}};b.execute=function(a,b,c){var d=Math.floor(1e11*Math.random()),e={name:a,params:b,callbackHash:d,timestamp:new Date,callback:c};l(e)};for(var l=function(a){var b=k();b?(m(b,a),n()):e.push(a)},m=function(a,b){d[b.callbackHash]=b,a.activeTasks++,console.log("Init task "+b.callbackHash+" to function "+b.name+" from worker num "+a.count),a.postMessage(JSON.stringify(b))},n=function(){for(;e[0];){var a=k();if(!a)break;m(a,e.pop())}},o=function(a,b){a.activeTasks--,n();var c=d[b.callbackHash];console.log("Return call "+c.callbackHash+" to function "+c.name+" from worker num "+a.count),b.timestamp=new Date,c.callback({result:b,call:c}),delete d[b.callbackHash]},p=0;g>p;p++)j()};