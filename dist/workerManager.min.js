/*! workerManager - v0.1.0 - 2013-07-17
* Copyright (c) 2013 Albert Serra; Licensed  */
var workerManager=function(a){a=a||{};var b=this,c=a.functions||[],d=[],e=[],f=a.numWorkers||4,g=function(a){for(var b=a.length,c="",d=0;b>d;d++){var e=a[d];c+='case "'+e.name+'":'+e.code+";break;"}return URL.createObjectURL(new window.Blob(["self.addEventListener('message', function(e) { var o = JSON.parse(e.data);var params = o.params; var result={success:true}; switch(o.name){"+c+"default:result={success:false,message:'Not implemented'};break;}; result.callbackHash=o.callbackHash;self.postMessage(JSON.stringify(result)); }, false);"]))},h=function(){return new Worker(g(c))},i=function(){var a=h();return a.addEventListener("message",function(a){k(this,JSON.parse(a.data))},!1),a.count=e.length,a.activeTasks=0,e.push(a),a},j=function(){for(var a=-1,b=0,c=0;e[c];c++){if(0==e[c].activeTasks)return e[c];(e[c].activeTasks<a||0>a)&&(a=e[c].activeTasks,b=c)}return e[b]};b.execute=function(a,b,c){var e=Math.floor(1e11*Math.random()),f={name:a,params:b,callbackHash:e,timestamp:new Date,callback:c};d[e]=f;var g=j();g.activeTasks++,console.log("Init call "+f.callbackHash+" to function "+f.name+" from worker num "+g.count),g.postMessage(JSON.stringify(f))};for(var k=function(a,b){a.activeTasks--;var c=d[b.callbackHash];console.log("Return call "+c.callbackHash+" to function "+c.name+" from worker num "+a.count),b.timestamp=new Date,c.callback({result:b,call:c}),delete d[b.callbackHash]},l=0;f>l;l++)i()};